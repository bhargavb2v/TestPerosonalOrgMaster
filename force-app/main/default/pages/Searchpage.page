<apex:page >
  <!-- <apex:page controller="Plexus_PatientSearchController" action="{!init}"  tabStyle="Plexus_Patients__tab" sidebar="false" showHeader="{!IF(isAdmin == 'Yes',true,false)}" standardstylesheets="true">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    
    <script type="text/javascript">__sfdcSessionId = '{!$Api.Session_Id}';</script>
    <script src="../../soap/ajax/30.0/connection.js" type="text/javascript"></script>
    <style>
        .bPageBlock {
             border-top: 3px solid #1797c0 !important;
        }
         button.ui-button.ui-widget.ui-state-default.ui-corner-all.ui-button-icon-only.ui-dialog-titlebar-close:focus {
            outline: 0 !important;
        }
        
        .req {font-size: 120%; color:red;border-bottom: 0px dotted !importanant;} 
         th{color: white;white-space: normal;border-color: white;}
         thead{background-color: grey;}
         table{border-color: darkgray;}
        
        .pageBlockSection{
            background-color: #AED6F1;
            height: 25px;
            padding-left: 3px;
            /* vertical-align: middle !important; */
            font-weight: bold;
            color: white;
            /* align-content: center; */
            padding-top: 2px;
        }
        
        
        
        .bar {
          position: absolute;
          margin: auto;
          top: 0; bottom: 0; left: 0; right: 0;
          width: 200px;
          height: 50px;
          overflow: hidden;
          background-size:100px 100px;
          background-image: linear-gradient(-45deg,
             #33c9ff 25%, #00b2f2 25%, 
             #00b2f2 50%, #33c9ff 50%,
             #33c9ff 75%, #00b2f2 75%);
          animation: anim 1s linear infinite;
        }
        
        .bar p {
          width: 100px;
          margin: 6px auto;
          text-align: center;
          color: white;
        }
        
        .ui-autocomplete { 
            cursor:pointer; 
            height:120px; 
            overflow-y:scroll;
            z-index:2147483647;
        }    
    </style>
    <script>
        function setFocusOnLoad() {}
         $(document).ready(function(){
             setTimeout(function(){
                localStorage.setItem("activeMenu", 0);
                $(".navigation-bar li a").removeClass('active');
                $($(".navigation-bar li a")[localStorage.getItem("activeMenu")]).addClass('active');
             },0)            
        })
        //Visualforce.remoting.timeout = 120000; // Set timeout at page level
        var app = angular.module('MyApp', []);
        
        app.filter('pagination', function(){
             return function(input, start){
                 start = +start;
                 return input.slice(start);
             };
        });
        
        app.controller('PatientSearchController' ,['$scope',function($scope){
            $scope.patientResultList = [];
            $scope.errorMessage = null;
            $scope.regStudyList;
            
            $scope.pageSize = 10;
            $scope.curPage = 0;
            $scope.searchButton = false;
            $scope.pageInit = function(){  
                
            }
            
            $scope.searchButtonClick = function(){  
                if($scope.searchKey == null || $scope.searchKey == ''){
                    $scope.errorMessage = "Please provide the 'MRN' to continue.";
                    $scope.errorModalOpen();  
                    return;    
                }
                if($scope.searchKey.length < 3){
                    $scope.errorMessage = "Please provide at least 3 characters to continue.";
                    $scope.errorModalOpen();  
                    return; 
                }
                $scope.modalShown = true; 
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.Plexus_PatientSearchController.getPatientSearchResult}',$scope.searchKey,'{!siteSFId}',
                    function(result, event){
                        if(event.status) {
                           $scope.patientResultList = result; 
                           $scope.searchButton = true;
                           if($scope.patientResultList.length == 0){
                               window.location.href = '{!$Page.Plexus_PatientAddEdit}?sId={!studySFId}&mrn='+$scope.searchKey+'&mode=New'; 
                           }
                        }
                        else{
                            $scope.errorMessage = event.message;
                            $scope.errorModalOpen();
                        } 
                        $scope.modalShown = false; 
                        $scope.$apply();   
                    },{escape: false}
                );
            }  
            
            $scope.numberOfPages = function() {
                return Math.ceil($scope.patientResultList.length / $scope.pageSize);
            };
            
            $scope.patientRecClick = function(pat){
                if(pat != null){
                    if(pat.regStudySet.indexOf('{!studySFId}') > -1){
                        $scope.errorMessage = "Patient is already in SPARC IBD. Use the search field on 'My Patients' to update patient information.";
                        $scope.errorModalOpen();    
                    }
                    else{
                        window.location.href = '{!$Page.Plexus_PatientAddEdit}?pId='+pat.Id+'&sId={!studySFId}&mode=New';   
                    }
                }
                else{
                    window.location.href = '{!$Page.Plexus_PatientAddEdit}?sId={!studySFId}&mode=New';  
                }
            }
            
            $scope.backClick = function(){
                window.location.href = '{!$Page.Plexus_PatientListView}?sId={!studySFId}';
            }
            
            $scope.errorModalOpen = function(){
                $("#dialog" ).dialog({
                    height: "auto",
                    modal: true,
                    position: { my: 'top', at: 'top+150' },
                    open: function (event, ui) {
                     $('.ui-dialog').css('z-index',2147483647);
                    },
                 }); 
            }
            
            $('#dialog').on('dialogclose', function(event) {
                 $scope.errorMessage = null;
            });  
            
             $scope.formatPhoneNumber = function(s) {
                var s2 = (""+s).replace(/\D/g, '');
                var m = s2.match(/^(\d{3})(\d{3})(\d{4})$/);
                return (!m) ? null : "(" + m[1] + ") " + m[2] + "-" + m[3];
            }    
        }]);
    </script>
    <div ng-app="MyApp" class="ng-cloak">
    <div id="agapp" ng-controller="PatientSearchController" data-ng-init="pageInit()">
        <div style="{!IF(isAdmin == 'Yes','display:none','display:block')}">
            <c:Plexus_Header > </c:Plexus_Header>
        </div>
        <div class="{!IF(isAdmin == 'Yes','','landing-container')}" style="padding:25px;">
        <apex:form style="width:90%; margin:auto;align:center;" >
        <div id="dialog" class="divCls" title="Error" ng-show="errorMessage != null">
        {{errorMessage}}
        </div>
        <apex:pageBlock title="Enter Patient MRN">
            
            <div align="center"> 
                <form class="form-inline">
                    <div class="form-group">
                        <label class="labelCol">MRN<abbr class="req" >*</abbr></label>
                        <input type = "text" ng-model="searchKey"/>
                        <input type="button" value="Continue" ng-click="searchButtonClick()"/>
                    </div>
                </form>
            </div>

            <div ng-show="patientResultList.length > 0">
                Click on select icon (<span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>) to add the existing patient to the study.
                <table class="table" border="1" style="margin-top:7px;">
                    <thead class="thead-inverse">
                        <tr>
                            <th ng-click="sort('mrn')"  align="center" style="text-align: center;">MRN
                            <span class="glyphicon sort-icon" ng-show="sortKey=='mrn'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th ng-click="sort('patientName')"  align="center" style="text-align: center;">Patient Name
                            <span class="glyphicon sort-icon" ng-show="sortKey=='patientName'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th ng-click="sort('dob')" align="center" style="text-align: center;">DOB
                            <span class="glyphicon sort-icon" ng-show="sortKey=='dob'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th ng-click="sort('email')" align="center" style="text-align: center;">Email
                            <span class="glyphicon sort-icon" ng-show="sortKey=='email'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th ng-click="sort('phone')" align="center" style="text-align: center;">Phone
                            <span class="glyphicon sort-icon" ng-show="sortKey=='phone'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th align="center" style="text-align: center;">Select</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="patient in patientResultList|orderBy:sortKey:reverse |pagination: curPage * pageSize | limitTo:pageSize">
                            <td width="15%" align="center">{{patient.mrn}}</td>
                            <td width="30%" align="center">{{patient.name}}</td>
                            <td width="10%" align="center">{{patient.dob}}</td>
                            <td width="25%" align="center">{{patient.email}}</td>
                            <td width="15%" align="center">
                            {{formatPhoneNumber(patient.phone)}}
                            </td>
                            <td width="5%" align="center">
                                <a id="ahref" href="#" ng-click="patientRecClick(patient)">
                                    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
                                </a>
                            </td>
                        </tr>
                        <tr height="30px" ng-show="patientResultList != null && patientResultList.length == 0">
                            <td colspan="6" align="center" style="vertical-align:middle"> 
                            No matching records found
                            </td>
                        </tr>
                    </tbody>
                </table> 
                
                <div class="row" ng-show="patientResultList != null && patientResultList.length > 5">
                    <div class="col-md-12">
                        <span class="pull-right">
                            <form class="form-inline">
                            <div class="form-group">
        
                                <button type="button" class="btn btn-primary" ng-disabled="curPage == 0" ng-click="curPage = curPage-1">PREV</button>
                                <span>Page {{curPage + 1}} of {{ numberOfPages() }}</span>
        
                                <button type="button" class="btn btn-primary" ng-disabled="curPage >= patientResultList.length/pageSize - 1" ng-click="curPage = curPage+1">NEXT</button>
                            </div>
                            </form>
                        </span>
                    </div>
                </div>
                
               
            </div>
            <div>
                <input type="button" value="Back" class="btn btn-success" ng-click="backClick()"/>
            </div>
        </apex:pageBlock>
        </apex:form>
        </div>
            <div style="{!IF(isAdmin == 'Yes','display:none','display:block')}">
            <c:Plexus_Footer > </c:Plexus_Footer>
            </div>
    </div>
    </div>
</apex:page> -->
</apex:page>