<apex:page >
  <!-- <apex:page controller="Plexus_PatientAddEditController"  tabStyle="Plexus_Patients__tab" action="{!init}" sidebar="false" showHeader="{!IF(isAdmin == 'Yes',true,false)}" standardstylesheets="true" docType="html-5.0" >
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    
     <script type="text/javascript">__sfdcSessionId = '{!$Api.Session_Id}';</script>
    <script src="../../soap/ajax/30.0/connection.js" type="text/javascript"></script>
    <style>
        .bPageBlock {
             border-top: 3px solid #1797c0 !important;
        }
        
        button.ui-button.ui-widget.ui-state-default.ui-corner-all.ui-button-icon-only.ui-dialog-titlebar-close:focus {
            outline: 0 !important;
        }

        th {
            background-color: #AAB7B8;
            color: white;
            border-bottom: 0px solid #ddd !important;
        }
        table{border-color: darkgray;}
        
        .pageBlockSection{
            background-color: #AED6F1;
            height: 25px;
            padding-left: 3px;
            /* vertical-align: middle !important; */
            font-weight: bold;
            color: white;
            /* align-content: center; */
            padding-top: 2px;
        }
        
        .req {font-size: 120%; color:red;border-bottom: 0px dotted !importanant;} 
        
        .ng-modal-overlay {
          /* A dark translucent div that covers the whole screen */
          position:fixed;
          z-index:9999;
          top:0;
          left:0;
          width:100%;
          height:100%;
          background-color:#000000;
          opacity: 0.8;
        }
        .ng-modal-overlaytemp {
          /* A dark translucent div that covers the whole screen */
          position:fixed;
          z-index:10010;
          top:0;
          left:0;
          width:100%;
          height:100%;
          background-color:#000000;
          opacity: 0.8;
        }
        .ng-modal-dialog {
          /* A centered div above the overlay with a box shadow. */
          z-index:10001;
          position: absolute;
          width: 50%; /* Default */
        
          /* Center the dialog */
          top:200px;
          left: 50%;
          transform: translate(-50%, -50%);
          -webkit-transform: translate(-50%, -50%);
          -moz-transform: translate(-50%, -50%);
        
          background-color: #fff;
          box-shadow: 4px 4px 80px #000;
        }
        
        .ng-modal-dialogtemp {
          /* A centered div above the overlay with a box shadow. */
          z-index:10011;
          position: absolute;
          width: 50%; /* Default */
        
          /* Center the dialog */
          top:200px;
          left: 50%;
          transform: translate(-50%, -50%);
          -webkit-transform: translate(-50%, -50%);
          -moz-transform: translate(-50%, -50%);
        
          background-color: #fff;
          box-shadow: 4px 4px 80px #000;
        }
        
        .ng-modal-dialog-content {
          padding:10px;
          text-align: left;
        }
        .ng-modal-close {
          position: absolute;
          top: 3px;
          right: 5px;
          padding: 5px;
          cursor: pointer;
          font-size: 120%;
          display: inline-block;
          font-weight: bold;
          font-family: 'arial', 'sans-serif';
        }
        
        .bar {
          position: absolute;
          margin: auto;
          top: 0; bottom: 0; left: 0; right: 0;
          width: 200px;
          height: 50px;
          overflow: hidden;
          background-size:100px 100px;
          background-image: linear-gradient(-45deg,
             #33c9ff 25%, #00b2f2 25%, 
             #00b2f2 50%, #33c9ff 50%,
             #33c9ff 75%, #00b2f2 75%);
          animation: anim 1s linear infinite;
        }
        
        .bar p {
          width: 100px;
          margin: 6px auto;
          text-align: center;
          color: white;
        }
        
        .ui-autocomplete { 
            cursor:pointer; 
            height:120px; 
            overflow-y:scroll;
            z-index:2147483647;
        }   
        
        #myFile + div {
          /*border: 1px solid green;*/
          right: -5.5em;
          top: -1.2em;
          height: 1em;
          width: 6.7em;
          position: relative;
        } 
        .input-disabled{background-color:#EBEBE4;border:1px solid #ABADB3;padding:2px 1px;}
    </style>
    <script>
        function setFocusOnLoad() {}
        $(document).ready(function() {
            $("#dob").datepicker({
                onSelect: function(dateText) {
                            onDateSelect(this.value,'dob');
                          },
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                yearRange: '-100:+0'
            });
            
            $("#dateConsent").datepicker({
                onSelect: function(dateText) {
                            onDateSelect(this.value,'dateConsent');
                          },
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                yearRange: '-100:+0'
             });
             
             $("#diagnosisDate").datepicker({
                onSelect: function(dateText) {
                            onDateSelect(this.value,'diagnosisDate');
                          },
                changeMonth: true,
                changeYear: true,
                maxDate: new Date(),
                yearRange: '-100:+0'
             });
            
            $( "#abcd" ).datepicker({
                showOn: "both",      
                buttonImage: "/orange-widget/img/miniCal.gif",      
                buttonImageOnly: true,    
                changeMonth: true,      
                changeYear: true,
                yearRange: '-100:+0',
                showButtonPanel: true,
                dateFormat: 'dd/mm/yy',
                minDate: 0, maxDate: "+1Y",
                onClose: function( selectedDate ) {
                    $("body").undelegate("button[data-handler=today]", "click");
                    $( "#RDate" ).datepicker( "option", "minDate", selectedDate );
                },
                beforeShow: function(el,ui) {
                    $("body").delegate("button[data-handler=today]", "click", function() { 
                        $("#Date").datepicker("setDate", new Date()).datepicker( "hide" );
                        $("#RDate").focus(); // set focus to the next datepicker
                    });
                }
            });
            setTimeout(function(){
                localStorage.setItem("activeMenu", 0);
                $(".navigation-bar li a").removeClass('active');
                $($(".navigation-bar li a")[localStorage.getItem("activeMenu")]).addClass('active');
             },0) 
        });
        
        function onDateSelect(val,type){
            angular.element(document.getElementById('agapp')).scope().DateSelect(val,type); 
        }
        
        function BindControls(val) {
            var sites = val;
            
            $('#siteListNew').autocomplete({
                source: sites,
                 select: function(event, ui) {
                            onSelect(ui.item.value);
                         },
                minLength: 0,
                scroll: true
            }).focus(function() {
                $(this).autocomplete("search", $(this).val());
            });
        }
        
        function onSelect(val) {
            angular.element(document.getElementById('agapp')).scope().siteSelect(val);
        }
    
        Visualforce.remoting.timeout = 120000; // Set timeout at page level
        var app = angular.module('MyApp', []);
        
        app.filter('pagination', function(){
             return function(input, start){
                 start = +start;
                 return input.slice(start);
             };
        });
        
        app.directive('modalDialog', function() {
          return {
            restrict: 'E',
            scope: {
              show: '='
            },
            replace: true, // Replace with the template below
            transclude: true, // we want to insert custom content inside the directive
            link: function(scope, element, attrs) {
              scope.dialogStyle = {};
              if(attrs.width)
                scope.dialogStyle.width = attrs.width;
              if(attrs.height)
                scope.dialogStyle.height = attrs.height;
              scope.hideModal = function() {
                scope.show = false;
              };
            },
           template: function(tElement, tAttrs) {
                if(tAttrs.type == 'Loading'){
                    return "<div class='ng-modal' ng-show='show'><div class='ng-modal-overlaytemp'></div><div class='ng-modal-dialogtemp' ng-style='dialogStyle'><div ng-transclude></div></div></div>";
                }
                else if(type='FileUploadWindow'){
                    return "<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay''></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>";
                }
                else if(type='DiagnosisWindow'){
                    return "<div class='ng-modal' ng-show='show'><div class='ng-modal-overlay''></div><div class='ng-modal-dialog' ng-style='dialogStyle'><div class='ng-modal-close' ng-click='hideModal()'>X</div><div class='ng-modal-dialog-content' ng-transclude></div></div></div>";
                }
             } 
          };
        });
        
        app.controller('PatientAddEditController' ,['$scope',function($scope){
            $scope.userForm = {};
            $scope.pageMode = '{!pageMode}';
            $scope.errorMessage;
            var today = new Date();
            today.setHours(0, 0, 0, 0);
            
            $scope.siteStudyVersionMap = [];
            $scope.consentValues;
            $scope.reasonValues;
            $scope.prefixValues;
            $scope.genderValues;
            $scope.docTypeValues;
            $scope.diagnosisValues;
            
            $scope.pageSize = 2;
            $scope.curPage = 0;
            $scope.dCurPage = 0;
            $scope.caCurPage = 0;
            $scope.aCurPage = 0;
            $scope.reverse = true;
            
            $scope.regStudyList = [];
            $scope.attachements = [];
            $scope.diagnosisList = [];
            $scope.conActivityList = [];
            
            $scope.delAttList = [];
            $scope.delDiagList = [];
            
            $scope.deletedDocId = null;
            $scope.deletedDiagId = null;
            
            $scope.regStudies = null;
            
            var today = new Date();
            $scope.displayName = null;
            
            $scope.patientReEnterId = null;

            $scope.pageInit = function() {  
                $scope.modalShown = true; 
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.Plexus_PatientAddEditController.getInitInformation}','{!studySFId}','{!siteSFId}','{!recordId}',$scope.pageMode,
                   function(result, event) {
                       $scope.consentValues = result.conStatList;
                       $scope.reasonValues = result.withReasonList;
                       $scope.prefixValues = result.prefixList;
                       $scope.genderValues = result.genderList;
                       $scope.docTypeValues = result.docTypeList;
                       $scope.diagnosisValues = result.diagnosisValues;
                       $scope.siteStudyVersionMap = result.siteStudyVersionMap;
                       $scope.userForm = result.patientForm;

                       if($scope.pageMode == 'New'){
                           $scope.userForm.consentStatus = 'Consented'; 
                           if('{!mrn}' != null && '{!mrn}' != ''){
                               $scope.userForm.patientId = '{!mrn}';
                           }
                       }
                       if('{!recordId}' != null && '{!recordId}' != ''){
                           $scope.attachements = result.docsList;
                           $scope.conActivityList = result.conActivityList;
                           //$scope.conActivityList = $filter('orderBy')(result.conActivityList, 'conLastModDate', true);
                           //console.log($scope.conActivityList);
                           $scope.diagnosisList = result.diagnosisList;
                           $scope.regStudies = result.regStudies;
                           $scope.displayName = $scope.userForm.firstName +' '+$scope.userForm.lastName +' ['+$scope.userForm.patientId +']'+ ' - '+'['+$scope.userForm.name +']';
                           
                           $scope.regStudiesString = '';
                           if($scope.regStudies != null){
                               for(var i=0;i<$scope.regStudies.length;i++){
                                   if($scope.regStudies.length == 1){
                                       $scope.regStudiesString = '["'+ $scope.regStudies[i] +'"]'
                                   }
                                   else if(i == ($scope.regStudies.length - 1)){
                                       $scope.regStudiesString = $scope.regStudiesString + '"'+ $scope.regStudies[i] +'"]'; 
                                   }
                                   else{
                                       $scope.regStudiesString = $scope.regStudiesString + '["'+ $scope.regStudies[i] +'", '; 
                                   }  
                               }
                           }
                       }
                       else{ 
                           $scope.userForm.consentStatus = 'Consented';   
                           $scope.userForm.prefix = 'Select';  
                           $scope.userForm.gender = 'Select';  
                       }
                       $scope.modalShown = false;
                       $scope.$apply();
                   },{escape: false}
                );
            }  
            
            $scope.DateSelect = function(val,type){
                if(type == 'dob'){
                    $scope.userForm.dob = val;
                }
                else if(type == 'dateConsent'){
                    $scope.userForm.dateConsent = val;
                } 
                else if(type == 'diagnosisDate'){
                    $scope.diagForm.diagnosisDate = val;
                }
                $scope.$apply();
            }
            
            $scope.sort = function(keyname){
                $scope.sortKey = keyname;   //set the sortKey to the param passed
                $scope.reverse = !$scope.reverse; //if true make it false and vice versa
                console.log(keyname);
            };
            
            $scope.validationRules = function(){
                 var flag = false;
                 if($scope.userForm.firstName == null || $scope.userForm.firstName == ''
                            || $scope.userForm.phone == null || $scope.userForm.phone == '' 
                            || $scope.userForm.prefix == null || $scope.userForm.prefix == 'Select'  
                            || $scope.userForm.lastName == null || $scope.userForm.lastName == '' 
                            || $scope.userForm.email == null || $scope.userForm.email == '' 
                            || $scope.userForm.patientId == null || $scope.userForm.patientId == '' 
                            || $scope.userForm.gender == null || $scope.userForm.gender == 'Select' 
                            || $scope.userForm.dob == null || $scope.userForm.dob == '' 
                            || $scope.userForm.dateConsent == null || $scope.userForm.dateConsent == ''
                            ){

                    $scope.errorMessage = 'Please provide the required field(s) to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }

                if($scope.pageMode == 'New'){
                    if($scope.patientReEnterId == null || $scope.patientReEnterId == ''){
                        $scope.errorMessage = 'Please provide the required field(s) to continue.';
                        flag = true;
                        $scope.errorModalOpen();  
                        return false;  
                    }  

                    if($scope.userForm.patientId != $scope.patientReEnterId){
                        $scope.errorMessage = 'The MRN you entered do not match. Please re-enter the MRN.';
                        flag = true;
                        $scope.errorModalOpen();  
                        return false;  
                    }
                }
                
                if (($scope.userForm.consentStatus == 'Consent Withdrawn') && ($scope.userForm.reasonConWithdraw == null || $scope.userForm.reasonConWithdraw == 'Select')) {
                    $scope.errorMessage = 'Please provide a reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if (($scope.userForm.reasonConWithdraw == 'Other') && ($scope.userForm.otherReasonWithdraw == null || $scope.userForm.otherReasonWithdraw == '')) {
                    $scope.errorMessage = 'Please provide other reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if($scope.userForm.phone.length != 10){

                    $scope.errorMessage = "Invalid phone number, please enter a valid 'Preferred Phone' to continue.";
                    flag = true;
                    $scope.errorModalOpen();  
                    return false;  
                }
                
                if($scope.userForm.altPhone != null && $scope.userForm.altPhone != '' && $scope.userForm.altPhone.length != 10){

                    $scope.errorMessage = "Invalid phone number, please enter a valid 'Alternate Phone' to continue.";
                    flag = true;
                    $scope.errorModalOpen(); 
                    return false;   
                }
                
                var consentDate = new Date($scope.userForm.dateConsent);
                if(consentDate >  today){
                    $scope.errorMessage = "'Date of Consent Status' cannot be a future date.";
                    flag = true;
                    $scope.errorModalOpen();  
                    return false;
                } 
                
                var dob = new Date($scope.userForm.dob);
                if(dob >= consentDate){
                    $scope.errorMessage = "'Date of Consent Status' should be greater than the 'Date of Birth'.";
                    flag = true;
                    $scope.errorModalOpen();  
                    return false;
                }  
                
                if($scope.diagnosisList.length == 0){
                    $scope.errorMessage = "Please provide 'IBD Diagnosis Information' to continue.";
                    flag = true;
                    $scope.errorModalOpen();  
                    return false;
                } 
                
                for(var i=0;i<$scope.attachements.length; i++){
                    var dob = new Date($scope.userForm.dob);
                    var datCon = new Date($scope.attachements[i].dateConsent);
                    
                    if(dob >= datCon){
                        $scope.errorMessage = "One or more Consent or Date Diagnosis Recorded in eCRF is less than the DOB, please review the existing records to continue.";
                        flag = true;
                        $scope.errorModalOpen();  
                        return false;
                    }
                }
                for(var i=0;i<$scope.diagnosisList.length; i++){
                    var dob = new Date($scope.userForm.dob);
                    var diag = new Date($scope.diagnosisList[i].diagnosisDate);
                    
                    if(dob >= diag){
                        $scope.errorMessage = "One or more Consent or Date Diagnosis Recorded in eCRF is less than the DOB, please review the existing records to continue.";
                        flag = true;
                        $scope.errorModalOpen();  
                        return false;
                    }
                }
            }
            
            $scope.setStudySitedetails = function(){
                $scope.userForm.studySFId = '{!studySFId}';
                $scope.userForm.siteSFId = '{!siteSFId}';
                $scope.userForm.studyVersionSFId = $scope.siteStudyVersionMap[$scope.userForm.siteSFId]; 
            }
            
            $scope.SaveClick = function(){    
                if($scope.validationRules() != false) {
                    $scope.setStudySitedetails();
                    $scope.modalShown = true; 

                    Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.Plexus_PatientAddEditController.insertForm}','{!recordId}',$scope.userForm,$scope.attachements,$scope.diagnosisList,$scope.delAttList,$scope.delDiagList, 
                        function(result, event) {   
                            if (event.status) {
                                $scope.userForm = result.patientForm;
                                window.location.href = '{!$Page.Plexus_PatientAddEdit}?pId='+$scope.userForm.Id+'&sId={!studySFId}&mode=View';
                            } else if (event.type === 'exception') {
                                if(event.message.indexOf('DUPLICATE_VALUE') > -1){
                                    if(event.message.indexOf('Email__c') > -1){
                                        $scope.errorMessage = "Email already exists. Please enter a new email to continue.";
                                        $scope.errorModalOpen();
                                    }
                                    else if(event.message.indexOf('Site_MRN__c') > -1){
                                        $scope.errorMessage = "MRN already exists. Please enter a new MRN to continue.";
                                        $scope.errorModalOpen();
                                    }
                                }
                                else if(event.message.indexOf('INVALID_EMAIL_ADDRESS') > -1){
                                    $scope.errorMessage = 'Invalid email address, please enter a valid email to continue.';
                                    $scope.errorModalOpen();
                                }
                                else if(event.message.indexOf('Consent Date should be greater than Consent Withdrawn Date: []') > -1){
                                       $scope.errorMessage = 'Consent Date should be greater than or equal to the Consent Withdrawn date.';
                                       $scope.errorModalOpen();
                                       }
                                else if(event.message.indexOf('Consent Withdrawn date should be greater than Consent Date: []') > -1){
                                       $scope.errorMessage = 'Consent Withdrawn date should be greater than or equal to the Consented date.';
                                       $scope.errorModalOpen();
                                       }
                                else{
                                    $scope.errorMessage = event.message;
                                    $scope.errorModalOpen();
                                }
                            } else {
                                $scope.errorMessage = event.message;
                                $scope.errorModalOpen();
                            }
                            $scope.modalShown = false; 
                            $scope.$apply();
                        },{escape: false}
                    );
                }  
            }
            
            $scope.SaveAndNewClick = function(){    
                if($scope.validationRules() != false) {
                    $scope.setStudySitedetails();
                    $scope.modalShown = true; 

                    Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.Plexus_PatientAddEditController.insertForm}','{!recordId}',$scope.userForm,$scope.attachements,$scope.diagnosisList,$scope.delAttList,$scope.delDiagList, 
                        function(result, event) {   
                            if (event.status) {
                                window.location.href = '{!$Page.Plexus_PatientAddEdit}?sId={!studySFId}&mode=New';
                            } else if (event.type === 'exception') {
                                
                                if(event.message.indexOf('DUPLICATE_VALUE') > -1){
                                    
                                    if(event.message.indexOf('Email__c') > -1){
                                        $scope.errorMessage = "Email already exists. Please enter a new email to continue.";
                                        $scope.errorModalOpen();
                                    }
                                    else if(event.message.indexOf('Site_MRN__c') > -1){
                                        $scope.errorMessage = "MRN already exists. Please enter a new MRN to continue.";
                                        $scope.errorModalOpen();
                                    }
                                }
                                else if(event.message.indexOf('INVALID_EMAIL_ADDRESS') > -1){
                                    $scope.errorMessage = 'Invalid email address, please enter a valid email to continue.';
                                    $scope.errorModalOpen();
                                }
                                else if(event.message.indexOf('Consent Date should be greater than Consent Withdrawn Date: []') > -1){
                                       $scope.errorMessage = 'Consent Date should be greater than the Consent Withdrawn date.';
                                       $scope.errorModalOpen();
                                       }
                                else if(event.message.indexOf('Consent Withdrawn date should be greater than Consent Date: []') > -1){
                                       $scope.errorMessage = 'Consent Withdrawn date should be greater than the Consented date.';
                                       $scope.errorModalOpen();
                                       }
                                else{
                                    $scope.errorMessage = event.message;
                                    $scope.errorModalOpen();
                                }
                            } else {
                                $scope.errorMessage = event.message;
                                $scope.errorModalOpen();
                            }
                            $scope.modalShown = false; 
                            $scope.$apply();
                        },{escape: false}
                    );
                }
            }
            
            $scope.EditClick = function(){
                window.location.href = '{!$Page.Plexus_PatientAddEdit}?pId='+$scope.userForm.Id+'&sId={!studySFId}&mode=Edit';
            }
            
             $scope.ResetPasswordClick = function(){
                  $scope.modalShown = true; 
                Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.Plexus_PatientAddEditController.resetPassword}',$scope.userForm.Id,
                   function(result, event) {
                      if(event.status){
                         if(result.isSuccess == true){
                          $scope.modalShown = false; 
                          $scope.invitedStatus = 'A new password for the user has been sent via email ('+result.email+').';
                            
                           //$scope.errorModalOpen();
                          //$scope.modalShown = false;  
                          // $scope.invitedStatus = 'An invitation has been sent successfully to the selected patient(s).';  
                        }else{
                         
                          $scope.errorMessage = event.message;
                          $scope.errorModalOpen();
                        }
                     }else{
                         
                          $scope.errorMessage = event.message;
                          $scope.errorModalOpen();
                     }
                    $scope.modalShown = false;
                    $scope.$apply();
                   },{escape: false}
                );
            }
            
            $scope.backBtnClicked = function(){
                window.location.href = "{!$page.Plexus_PatientListView}?sId={!studySFId}";
            }
            
            $scope.CancelClick = function(){ 
                if($scope.pageMode == 'View' || $scope.pageMode == 'New'){ 
                    window.location.href = '{!$Page.Plexus_PatientListView}?sId={!studySFId}';
                }
                else{
                    window.location.href = '{!$Page.Plexus_PatientAddEdit}?pId='+$scope.userForm.Id+'&sId={!studySFId}&mode=View';
                }
            }
            
            $scope.errorModalOpen = function(){
                $("#dialog" ).dialog({
                    height: 140,
                    modal: true,
                    open: function (event, ui) {
                     $('.ui-dialog').css('z-index',10001);
                    },
                 }); 
            }
            
            $('#dialog').on('dialogclose', function(event) {
                 $scope.errorMessage = null;
            });
            
            $scope.formatPhoneNumber = function(s) {
                var s2 = (""+s).replace(/\D/g, '');
                var m = s2.match(/^(\d{3})(\d{3})(\d{4})$/);
                return (!m) ? null : "(" + m[1] + ") " + m[2] + "-" + m[3];
            }
            
            var doc = document.documentElement;
            var left = 0;
            var top = 0;
            
            $scope.getScrollPosition = function() {
                left = (window.pageXOffset || doc.scrollLeft) - (doc.clientLeft || 0);
                top = (window.pageYOffset || doc.scrollTop)  - (doc.clientTop || 0);
            }
            
            $scope.addRegDoc = function(){
                 var flag = false;
                 if($scope.userForm.firstName == null || $scope.userForm.firstName == ''
                            || $scope.userForm.phone == null || $scope.userForm.phone == '' 
                            || $scope.userForm.prefix == null || $scope.userForm.prefix == 'Select'  
                            || $scope.userForm.lastName == null || $scope.userForm.lastName == '' 
                            || $scope.userForm.email == null || $scope.userForm.email == '' 
                            || $scope.userForm.patientId == null || $scope.userForm.patientId == '' 
                            || $scope.userForm.gender == null || $scope.userForm.gender == 'Select' 
                            || $scope.userForm.dob == null || $scope.userForm.dob == '' 
                            || $scope.userForm.dateConsent == null || $scope.userForm.dateConsent == ''
                            ){
                    
                    $scope.errorMessage = 'Please provide the required field(s) to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if($scope.pageMode == 'New'){
                    if($scope.patientReEnterId == null || $scope.patientReEnterId == ''){
                        $scope.errorMessage = 'Please provide the required field(s) to continue.';
                        flag = true;
                        $scope.errorModalOpen();    
                        return false;
                    }  
                }
                
                if (($scope.userForm.consentStatus == 'Consent Withdrawn') && ($scope.userForm.reasonConWithdraw == null || $scope.userForm.reasonConWithdraw == 'Select')) {
                    $scope.errorMessage = 'Please provide a reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if (($scope.userForm.reasonConWithdraw == 'Other') && ($scope.userForm.otherReasonWithdraw == null || $scope.userForm.otherReasonWithdraw == '')) {
                    $scope.errorMessage = 'Please provide other reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if(flag == false){
                    $scope.getScrollPosition();
                
                    $scope.attachForm = {};
                    $scope.attachForm.docType = 'Select';
                    document.getElementById('myFile').value = "";
                    $('#abc').val("");
                   
                    $scope.FileUploadWindow = true;    
                    window.scrollTo(0,0);
                }
            } 
            
            $scope.regDocCancelClicked = function(){ 
                $scope.FileUploadWindow = false;
                window.scrollTo(0,top);
            }
            
            $scope.uploadFile = function(){
                var input = document.getElementById('myFile');

                if(input.files[0] == null || input.files[0] == 'undefined'){
                    $scope.errorMessage = 'Please choose a file to upload.';
                    $scope.errorModalOpen();  
                    return;
                }
                if($scope.attachForm.docType == 'Select'){
                    $scope.errorMessage = "Please provide a 'Document Type' to continue.";
                    $scope.errorModalOpen();  
                    return;
                }
                
                var fileExtName = input.files[0].name;
                var fileExt = fileExtName.substring(fileExtName.lastIndexOf('.') + 1);
                
                if(fileExt != "pdf"){
                    $scope.errorMessage = "Please upload PDF document.";
                    $scope.errorModalOpen();
                    return;
                }

                $scope.uploadFileReader(input.files[0]);
            };
            
            $scope.uploadFileReader = function(file) {       
                var reader = new FileReader();     
    
                // Keep a reference to the File in the FileReader so it can be accessed in callbacks
                reader.file = file; 
    
                reader.onerror = function(e) {
                    switch(e.target.error.code) {
                        case e.target.error.NOT_FOUND_ERR:
                            $scope.errorMessage = "File Not Found!";
                            $scope.errorModalOpen(); 
                            break;
                        case e.target.error.NOT_READABLE_ERR:
                            $scope.errorMessage = "File is not readable";
                            $scope.errorModalOpen();
                            break;
                        case e.target.error.ABORT_ERR:
                            break; // noop
                        default:
                            $scope.errorMessage = "An error occurred reading this file.";
                            $scope.errorModalOpen();
                    };
                    $scope.modalShown = false;
                    $scope.$apply(); 
                };     
    
                reader.onabort = function(e) {
                    $scope.errorMessage = "File read cancelled";
                    $scope.errorModalOpen();
                    $scope.modalShown = false;
                    $scope.$apply(); 
                };
    
                reader.onload = function(e) {
                    $scope.attachForm.fileName = this.file.name;
                    $scope.attachForm.fileType = this.file.type;
                    $scope.attachForm.dateConsent = $scope.userForm.dateConsent;
                    $scope.attachForm.lastModifiedDate = getFormattedDate(today);

                    $scope.attachForm.fileBody = (new sforce.Base64Binary(e.target.result)).toString();
                    var fileSize = $scope.attachForm.fileBody.length;
                    if(fileSize > 1000000){
                        $scope.errorMessage = 'Your file is too large. File size should not exceed 1 MB. Please try again.';
                        $scope.errorModalOpen(); 
                        $scope.modalShown = false;
                        $scope.$apply(); 
                        return;
                    }

                    var flag=false;
                    for(var i = 0 ; i<$scope.attachements.length;i++){
                        if($scope.attachements[i].fileName == $scope.attachForm.fileName){
                            $scope.errorMessage = 'A file with the same name already exists.';
                            flag = true;
                            $scope.modalShown = false; 
                            $scope.errorModalOpen();
                            $scope.$apply();  
                            return;     
                        }
                    }
                    
                    if(flag == false){
                        $scope.attachements.push($scope.attachForm);
                        $scope.modalShown = false; 
                        $scope.FileUploadWindow = false; 
                        window.scrollTo(0,top); 
                        $scope.$apply();
                    }
                };
                reader.readAsBinaryString(file);
            }
            
            $scope.addDiagnosis = function(){
                 var flag = false;
                 if($scope.userForm.firstName == null || $scope.userForm.firstName == ''
                            || $scope.userForm.phone == null || $scope.userForm.phone == '' 
                            || $scope.userForm.prefix == null || $scope.userForm.prefix == 'Select'  
                            || $scope.userForm.lastName == null || $scope.userForm.lastName == '' 
                            || $scope.userForm.email == null || $scope.userForm.email == '' 
                            || $scope.userForm.patientId == null || $scope.userForm.patientId == '' 
                            || $scope.userForm.gender == null || $scope.userForm.gender == 'Select'  
                            || $scope.userForm.dob == null || $scope.userForm.dob == '' 
                            || $scope.userForm.dateConsent == null || $scope.userForm.dateConsent == ''){
                    
                    $scope.errorMessage = 'Please provide the required field(s) to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if($scope.pageMode == 'New'){
                    if($scope.patientReEnterId == null || $scope.patientReEnterId == ''){
                        $scope.errorMessage = 'Please provide the required field(s) to continue.';
                        flag = true;
                        $scope.errorModalOpen();   
                        return false; 
                    }  
                }
                
                if (($scope.userForm.consentStatus == 'Consent Withdrawn') && ($scope.userForm.reasonConWithdraw == null || $scope.userForm.reasonConWithdraw == 'Select')) {
                    $scope.errorMessage = 'Please provide a reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if (($scope.userForm.reasonConWithdraw == 'Other') && ($scope.userForm.otherReasonWithdraw == null || $scope.userForm.otherReasonWithdraw == '')) {
                    $scope.errorMessage = 'Please provide other reason for withdrawal to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return false;
                }
                
                if(flag == false){
                    $scope.getScrollPosition();
                
                    $scope.diagForm = {};
                    $scope.diagForm.diagnosis = 'Select';
                    $scope.diagForm.diagnosisDate = getFormattedDate(today);
                   
                    $scope.DiagnosisWindow = true;    
                    window.scrollTo(0,0);
                 }
             }
             
            $scope.diagCancelClicked = function(){ 
                $scope.DiagnosisWindow = false;
                window.scrollTo(0,top);
            }
            
            $scope.diagSaveClicked = function(){ 
                var flag = false;
                if($scope.diagForm.diagnosisDate ==null || $scope.diagForm.diagnosisDate == '' 
                            || $scope.diagForm.diagnosis == 'Select'){
                    $scope.errorMessage = 'Please provide the required field(s) to continue.';
                    flag = true;
                    $scope.errorModalOpen();
                    return;
                }

                var diagdate = new Date($scope.diagForm.diagnosisDate);

                if(diagdate > today){
                    $scope.errorMessage = "'Date Diagnosis Recorded in eCRF' cannot be a future date.";
                    flag = true;
                    $scope.errorModalOpen();
                    return; 
                }
                
                var dob = new Date($scope.userForm.dob);
                if(dob >= diagdate){
                    $scope.errorMessage = "'Date Diagnosis Recorded in eCRF' should be greater than the 'Date of Birth'.";
                    flag = true;
                    $scope.errorModalOpen();  
                }
                
                if(flag == false){
                    $scope.diagnosisList.push($scope.diagForm);
                    window.scrollTo(0,top);   
                    $scope.modalShown = false; 
                    $scope.DiagnosisWindow = false;  
                } 
                
            }
             
            $scope.formatPhoneNumber = function(s) {
                var s2 = (""+s).replace(/\D/g, '');
                var m = s2.match(/^(\d{3})(\d{3})(\d{4})$/);
                return (!m) ? null : "(" + m[1] + ") " + m[2] + "-" + m[3];
            }
            
            $scope.ConfirmModalOpen = function(){
                $("#confirmDialog" ).dialog({
                    height: 140,
                    width:500,
                    modal: true,
                    open: function (event, ui) {
                     $('.ui-dialog').css('z-index',10001);
                    },
                 }); 
            }
             
            $('#confirmDialog').on('dialogclose', function(event) {
                 indexAtt = null;
                 delIdAtt = null;
                 indexDiag = null;
                 delIdDiag = null;
                 delType = null;
                 $scope.isDeleteClick = 'No';
                 $scope.errorMessage = null;
            });
            
            var indexAtt;
            var delIdAtt;
            $scope.isDeleteClick;
            var delType;
            $scope.attDeleteClick = function(uForm,index){   
                $scope.errorMessage = "Are you sure you want to delete this record ? Click 'Ok' to continue.";
                delIdAtt = uForm.Id;
                indexAtt = index;
                $scope.isDeleteClick = 'Yes';
                delType = 'Attachment';
                $scope.ConfirmModalOpen();  
            };
            
            var indexDiag;
            var delIdDiag;
            $scope.isDeleteClick;
            $scope.diagDeleteClick = function(uForm,index){   
                $scope.errorMessage = "Are you sure you want to delete this record ? Click 'Ok' to continue.";
                delIdDiag = uForm.Id;
                indexDiag = index;
                $scope.isDeleteClick = 'Yes';
                delType = 'Diagnosis';
                $scope.ConfirmModalOpen();  
            };
            
            $scope.confirmWindowOk = function(){
                if(delType == 'Attachment'){
                    $scope.delAttList.push(delIdAtt);
                    $scope.attachements.splice(indexAtt,1);
                    if($scope.attachements.length > 0 && (($scope.attachements.length%5) == 0)){
                        $scope.aCurPage = $scope.aCurPage-1;
                    }
                    indexAtt = null;
                    delIdAtt = null;
                    $scope.isDeleteClick = 'No';
                    $scope.errorMessage = null;
                }
                 
                if(delType == 'Diagnosis'){
                    $scope.delDiagList.push(delIdDiag);
                    $scope.diagnosisList.splice(indexDiag, 1 );
                    if($scope.diagnosisList.length > 0 && (($scope.diagnosisList.length%5) == 0)){
                        $scope.dCurPage = $scope.dCurPage-1;
                    }
                    delIdDiag = null;
                    indexDiag = null;
                    $scope.isDeleteClick = 'No';
                    $scope.errorMessage = null;
                }
                $('#confirmDialog').dialog('close');
            }
            
            $scope.confirmWindowCancel = function(){
            
                if(delType == 'Attachment'){
                    indexAtt = null;
                    delIdAtt = null;
                    $scope.isDeleteClick = 'No';
                    $scope.errorMessage = null;
                    $('#confirmDialog').dialog('close');  
                }
                if(delType == 'Diagnosis'){
                    delIdDiag = null;
                    indexDiag = null;
                    $scope.isDeleteClick = 'No';
                    $scope.errorMessage = null;
                }
                $('#confirmDialog').dialog('close');
             }
             
             $scope.aNumberOfPages = function() {
                return Math.ceil($scope.attachements.length / 5);
             };
             $scope.dNumberOfPages = function() {
                return Math.ceil($scope.diagnosisList.length / 5);
             };
            
            $scope.caNumberOfPages = function(){
                return Math.ceil($scope.conActivityList.length / 5);    
            };
            
            $scope.consentStatusChanged = function(){
                if($scope.userForm.consentStatus != 'Consent Withdrawn'){
                    $scope.userForm.dateConsent = '';
                    $scope.userForm.reasonConWithdraw = 'Select';
                    $scope.userForm.otherReasonWithdraw = null;
                }
                else{
                    $scope.userForm.dateConsent='';
                    $scope.userForm.reasonConWithdraw = 'Select';
                    $scope.userForm.otherReasonWithdraw = null;
                }
            }
            $scope.reasonWithdrawnChanged = function(){
                if($scope.userForm.reasonConWithdraw != 'Other'){
                    $scope.userForm.otherReasonWithdraw = null;
                }
            }
        }]);
        
        function myTrim(x) {
            return x.replace(/^\s+|\s+$/gm,'');
        }
        
        function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }
        function isValidDate(date){
            var matches = /^(\d{2})[-\/](\d{2})[-\/](\d{4})$/.exec(date);
            if (matches == null) return false;
            var d = matches[2];
            var m = matches[1] - 1;
            var y = matches[3];
            var composedDate = new Date(y, m, d);
            return composedDate.getDate() == d &&
                    composedDate.getMonth() == m &&
                    composedDate.getFullYear() == y;
        }
        function getFormattedDate(date) {
          var year = date.getFullYear();
          var month = (1 + date.getMonth()).toString();
          month = month.length > 1 ? month : '0' + month;
          var day = date.getDate().toString();
          day = day.length > 1 ? day : '0' + day;
          return month + '/' + day + '/' + year;
        }
        $(function() {

            // We can attach the `fileselect` event to all file inputs on the page
            $(document).on('change', ':file', function() {
                var input = $(this),
                numFiles = input.get(0).files ? input.get(0).files.length : 1,
                label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                $('#abc').val(label);
            });

        });
        
        //to diable right click in certain element
        $('.disablerighClick').on("contextmenu",function(e){
            alert('right click disabled');
            return false;
        });

    </script>
    <div ng-app="MyApp" class="ng-cloak">
    <div id="agapp" ng-controller="PatientAddEditController" data-ng-init="pageInit()">
        <div style="{!IF(isAdmin == 'Yes','display:none','display:block')}">
            <c:Plexus_Header > </c:Plexus_Header>
        </div>
        <div ng-show="invitedStatus != null && invitedStatus != '' " >
         <div style="height:250px;background-color:white;" align="center">
                <div style="padding:100px" align="center">
                        <form class="form-inline">
                            <div class="form-group">
                                <label style="padding-right:20px">{{invitedStatus}}</label> 
                            </div>
                            <div style="padding-top:20px;padding-left:50px;" align="right">
                                <input type="button" class="btn" value="Back" ng-click="backBtnClicked()"/>
                            </div>
                        </form>
                </div>
            </div>
        </div>
        <div ng-hide="invitedStatus != null && invitedStatus != '' ">
        <div class="{!IF(isAdmin == 'Yes','','landing-container')}" style="padding-left: 25px;padding-right: 25px;padding-bottom: 25px;" >
        <apex:form style="width:100%; margin:auto;align:center;" >
        <div id="dialog" class="divCls" title="Error" ng-show="errorMessage != null">
            {{errorMessage}}
        </div>
        <div id="confirmDialog" class="divCls" title="Confirmation" ng-show="errorMessage != null && isDeleteClick == 'Yes'">
            {{errorMessage}}<br/><br/>
            <div align="right">
                <input type="button" value="Ok" ng-click="confirmWindowOk()"/>&nbsp;
                <input type="button" value="Cancel" ng-click="confirmWindowCancel()"/>
            </div>
        </div>
        <div width="70%" >
            
            <h3>{{pageMode == 'New' ? 'New Patient' : displayName}}</h3><br/><br/>
            <apex:pageblock mode="detail" id="leadPB">
            <div ng-show="pageMode == 'Edit' || pageMode == 'New'">
                <div ng-show="pageMode == 'Edit' || pageMode == 'New'">
                <apex:pageblockbuttons location="top">
                    <div style="display:-webkit-box">
                    <input type="button" ng-show="pageMode == 'Edit' || pageMode == 'New'" class="btn" value = "Save" ng-click="SaveClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                    <input type="button" ng-show="pageMode == 'Edit' || pageMode == 'New'" class="btn" value = "Save & New" ng-click="SaveAndNewClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                    <input type="button" ng-show="pageMode == 'Edit' || pageMode == 'New'" class="btn" value = "Cancel" ng-click="CancelClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                    <input type="button" ng-show="pageMode == 'View'" class="btn" value = "Back" ng-click="CancelClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;"/>
                    <input type="button" ng-show="pageMode == 'View'" class="btn" value = "Edit" ng-click="EditClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                    <input type="button" ng-show="pageMode == 'View'" class="btn" value = "Reset Password" ng-click="ResetPasswordClick()" style="background:#FCFCFC;border: 1px solid #b5b5b5;border-bottom-color:#7f7f7f;height: 22px;{!IF(AND(isAdmin == 'Yes',isUser) ,'display:block','display:none') }"/>
                    </div>
                </apex:pageblockbuttons>
                </div>
                <div class="pageBlockSection">Patient Information</div>
                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">MRN<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New' && (userForm.Id == null || userForm.Id == '')">
                            <input type="text" class="dataCpl" id="patId" maxlength="15" ng-model="userForm.patientId" style="display: inherit;margin-top: 3px;height:19;"/>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New' && (userForm.Id != null && userForm.Id != '')">
                            <label class="dataCpl" style="font-weight: normal !important;margin-top:7px;">{{userForm.patientId}}</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'Edit'">
                            <label class="dataCpl" style="font-weight: normal !important;margin-top:7px;">{{userForm.patientId}}</label>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Preferred Phone<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                             <input type="text" class="dataCpl" id="phone" onkeypress="return isNumber(event)" maxlength="10" ng-model="userForm.phone" style="display: inherit;margin-top: 3px;"/>
                        </td>
                    </tr>
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <label class="labelCol" style="display:inherit;">Re-enter MRN<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <input type="text" class="dataCpl" oncontextmenu="return false" id="patReId" maxlength="15" ng-model="patientReEnterId" onpaste="return false;" onCopy="return false" onCut="return false" onDrag="return false" onDrop="return false" style="display: inherit;margin-top: 3px;height:19;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <label class="labelCol" style="display:inherit;">Prefix<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <select ng-model="userForm.prefix" ng-options="val for val in prefixValues" style="display: inherit;margin-top: 3px;height: 24px;"> 
                            </select>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Alternate Phone</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                             <input type="text" class="dataCpl" id="altPhone" ng-model="userForm.altPhone" onkeypress="return isNumber(event)" maxlength="10"  style="display: inherit;margin-top: 3px;"/>
                        </td>
                    </tr>
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <label class="labelCol" style="display:inherit;">Prefix<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <select ng-model="userForm.prefix" ng-options="val for val in prefixValues" style="display: inherit;margin-top: 3px;height: 24px;"> 
                            </select>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <label class="labelCol" style="display:inherit;">First Name<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <input type="text" class="dataCpl" id="firstName" maxlength="30" ng-model="userForm.firstName" style="display: inherit;margin-top: 3px;height:19;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Preferred Email<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="email" maxlength="80" ng-model="userForm.email" style="display: inherit;margin-top: 3px;"/>
                        </td>
                    </tr>
                    
                     <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <label class="labelCol" style="display:inherit;">First Name<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <input type="text" class="dataCpl" id="firstName" maxlength="30" ng-model="userForm.firstName" style="display: inherit;margin-top: 3px;height:19;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <label class="labelCol" style="display:inherit;">Last Name<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="30%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <input type="text" class="dataCpl" id="lastName" maxlength="30" ng-model="userForm.lastName" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Alternate Email</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="altemail" maxlength="80" ng-model="userForm.altEmail" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                    </tr>
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <label class="labelCol" style="display:inherit;">Last Name<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="30%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <input type="text" class="dataCpl" id="lastName" maxlength="30" ng-model="userForm.lastName" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <label class="labelCol" style="display:inherit;">Gender<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode != 'New'">
                            <select ng-model="userForm.gender" ng-options="val for val in genderValues" style="display: inherit;margin-top: 3px;height: 24px;"> 
                            </select>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">DOB<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="dob" ng-readonly="true" ng-model="userForm.dob" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                    </tr>
                    <tr width="100%" height="30px" ng-show="pageMode == 'New'"> 
                         <td align="right" width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <label class="labelCol" style="display:inherit;">Gender<abbr class="req" >*</abbr></label>
                        </td>
                        <td width="20%" style="vertical-align: middle;" ng-show="pageMode == 'New'">
                            <select ng-model="userForm.gender" ng-options="val for val in genderValues" style="display: inherit;margin-top: 3px;height: 24px;"> 
                            </select>
                        </td>
                         
                         <td align="right" width="20%" style="vertical-align: middle;">
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                        </td>
                     </tr>    
                </table>
                <div class="pageBlockSection" >Address Information</div>
                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Address</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="address" maxlength="50" ng-model="userForm.address" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">City</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="city" maxlength="30" ng-model="userForm.city" style="display: inherit;margin-top: 3px;"/>
                        </td>
                    </tr>
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">State</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="state" maxlength="30" ng-model="userForm.state" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Country</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" id="country" maxlength="30" ng-model="userForm.country" style="display: inherit;margin-top: 3px;"/>
                        </td>
                    </tr>
 
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Zip Code</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            <input type="text" class="dataCpl" id="zipCode" maxlength="20" ng-model="userForm.zipCode" style="display: inherit;margin-top: 3px;"/>
                        </td>
                        <td align="right" width="20%" style="vertical-align: middle;"></td>
                        <td width="30%" style="vertical-align: middle;"></td>
                    </tr>
                </table>
            </div>
            
            <div ng-show="pageMode == 'View'"> 
                <div class="pageBlockSection">Patient Information</div>
                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">MRN</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                            {{userForm.patientId}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Preferred Phone</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                             {{formatPhoneNumber(userForm.phone)}}
                        </td>
                    </tr>
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Prefix</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                            {{userForm.prefix}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Alternate Phone</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.altPhone != null ? formatPhoneNumber(userForm.altPhone) :'-'}}
                        </td>
                    </tr>
                    
                     <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">First Name</label>
                        </td>
                        <td width="20%" style="vertical-align: middle;">
                            {{userForm.firstName}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Preferred Email</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.email}}
                        </td>
                    </tr>
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Last Name</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.lastName}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Alternate Email</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.altEmail != null ? userForm.altEmail : '-' }}
                        </td>
                    </tr>
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Gender</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.gender}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">DOB</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.dob}}
                        </td>
                    </tr>  
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Patient ID</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.name}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            
                        </td>
                        <td width="30%" style="vertical-align: middle;">

                        </td>
                    </tr>   
                </table>
                <div class="pageBlockSection" >Address Information</div>
                <table width="100%" border="0" cellpadding="0" cellspacing="0">
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Address</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.address != null ? userForm.address : '-'}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">City</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.city != null ? userForm.city : '-'}}
                        </td>
                    </tr>
                    
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">State</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.state != null ? userForm.state : '-'}}
                        </td>
                        
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Country</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.country != null ? userForm.country : '-'}}
                        </td>
                    </tr>
 
                    <tr width="100%" height="30px">
                        <td align="right" width="20%" style="vertical-align: middle;">
                            <label class="labelCol" style="display:inherit;">Zip Code</label>
                        </td>
                        <td width="30%" style="vertical-align: middle;">
                            {{userForm.zipCode != null ? userForm.zipCode : '-'}}
                        </td>
                        <td align="right" width="20%" style="vertical-align: middle;"></td>
                        <td width="30%" style="vertical-align: middle;"></td>
                    </tr>
                </table>  
            </div>
            <div >
                <div class="pageBlockSection" >Consent Information</div>
                <div ng-show = "pageMode == 'New' || pageMode == 'Edit'">
                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Site ID</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.siteId}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Site Name</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.siteName}}
                            </td>
                        </tr>
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Study ID</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.studyId}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Study Name</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.studyName}}
                            </td>
                        </tr>
                        
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Consent Status<abbr class="req" >*</abbr></label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                                <select ng-model="userForm.consentStatus" ng-options="val for val in consentValues" ng-change="consentStatusChanged()" ng-disabled="pageMode == 'New'" style="display: inherit;margin-top: 3px;height: 24px;"> 
                                </select>
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Date of Consent Status<abbr class="req" >*</abbr></label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                                <input type="text" class="dataCpl" id="dateConsent" ng-readonly="true" ng-model="userForm.dateConsent" style="display: inherit;margin-top: 3px;"/>
                            </td>  
                        </tr>
                        
                        <tr width="100%" height="30px" ng-show="userForm.consentStatus == 'Consent Withdrawn'">
                            <td align="right" width="20%" style="vertical-align: middle;" >
                                <label class="labelCol"   style="display:inherit;">Reason for Withdrawal<abbr class="req">*</abbr></label>
                            </td> 
                             <td width="30%" style="vertical-align: middle;">
                                 <select ng-model="userForm.reasonConWithdraw" ng-options="val for val in reasonValues"  ng-show="userForm.consentStatus == 'Consent Withdrawn'" ng-change="reasonWithdrawnChanged()" style="display: inherit;margin-top: 3px;"/>
                              </td>
                              
                              <td align="right" width="20%" style="vertical-align: middle;" >
                                <label class="labelCol"  ng-show="userForm.reasonConWithdraw == 'Other' && userForm.consentStatus == 'Consent Withdrawn'" style="display:inherit;">Other Withdrawal Reason<abbr class="req">*</abbr></label>
                            </td>
                            <td width="30%" style="vertical-align: middle;" >
                                <input type="text"  ng-show="userForm.reasonConWithdraw == 'Other' && userForm.consentStatus == 'Consent Withdrawn'" ng-model="userForm.otherReasonWithdraw" style="display: inherit;margin-top: 3px;"/>
                            </td>   
                         </tr>   
                    </table>
                </div>
                <div ng-show = "pageMode == 'View'">
                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Site ID</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.siteId}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Site Name</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.siteName}}
                            </td>
                        </tr>
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Study ID</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.studyId}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Study Name</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                            {{userForm.studyName}}
                            </td>
                        </tr>
                        
                        <tr width="100%" height="30px">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Consent Status</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                                {{userForm.consentStatus}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Date of Consent Status</label>
                            </td>
                            <td width="30%" style="vertical-align: middle;">
                                {{userForm.dateConsent}}
                            </td>
                                                    
                        </tr>
                        <tr width="100%" height="30px" ng-show="userForm.consentStatus == 'Consent Withdrawn'">
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" style="display:inherit;">Reason  for Withdrawal</label>
                             </td>
                             <td width="30%" style="vertical-align: middle;">
                                {{userForm.reasonConWithdraw}}
                            </td>
                            
                            <td align="right" width="20%" style="vertical-align: middle;">
                                <label class="labelCol" ng-show="userForm.reasonConWithdraw == 'Other' && userForm.consentStatus == 'Consent Withdrawn'" style="display:inherit;">Other Withdrawal Reason</label>
                            </td>
                            <td width="30%" ng-show="userForm.reasonConWithdraw == 'Other' && userForm.consentStatus == 'Consent Withdrawn'" style="vertical-align:">
                                {{userForm.otherReasonWithdraw}}
                            </td>
                         </tr>
                    </table>
                </div>
                <div align="center" style="padding-top:15px;">
                    <input type="button" ng-show = "pageMode == 'Edit' || pageMode == 'New'" value="Add Regulatory Document" ng-click="addRegDoc()" style="{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                </div>
                <div>
                     
                <div ng-show="attachements.length > 0">
                    <table class="table .table-bordered" border="1"  style="width:80% !important; margin-left:auto;margin-right:auto;margin-top:20px; ">
                        <thead class="thead-inverse">
                        <tr>
                            <th ng-click="sort('fileName')" style="text-align: center;">Document Name
                                <span class="glyphicon sort-icon" ng-show="sortKey=='fileName'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>

                            <th ng-click="sort('docType')" style="text-align: center;">Document Type
                                <span class="glyphicon sort-icon" ng-show="sortKey=='docType'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>

                            <th ng-click="sort('dateConsent')" style="text-align: center;">Date Regulatory Document Uploaded
                                <span class="glyphicon sort-icon" ng-show="sortKey=='dateConsent'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                            </th>
                            <th ng-show = "pageMode == 'Edit' || pageMode == 'New'" style="text-align: center;" align="center">Delete</th>
                        </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="rec in attachements | orderBy:sortKey:reverse|pagination: (aCurPage * 5)| limitTo:5  track by $index">
                                <td ng-show="pageMode == 'View'" align="center" style="{!IF(isAdmin == 'Yes','display:none','display:block')}">
                                    <a ng-href="/ibdplexus/servlet/servlet.FileDownload?file={{rec.attId}}&mode=View" target="_blank" style="color: #337ab7;"><u>{{rec.fileName}}</u></a>&nbsp;
                                </td>
                                <td ng-show="pageMode == 'View'" align="center" style="{!IF(isAdmin == 'Yes','display:block','display:none')}">
                                    <a ng-href="/servlet/servlet.FileDownload?file={{rec.attId}}&mode=View" target="_blank" style="color: #337ab7;"><u>{{rec.fileName}}</u></a>&nbsp;
                                </td>
                                <td ng-show="pageMode == 'Edit' || pageMode == 'New'" align="center">
                                    {{rec.fileName}}
                                </td>
                                <td align="center">{{rec.docType}}</td>
                                <td align="center">{{rec.lastModifiedDate}}</td>
                                <td ng-show = "pageMode == 'Edit' || pageMode == 'New'" align="center">
                                <input type="button" value="Delete" ng-click="attDeleteClick(rec,attachements.indexOf(rec))"/>
                                </td>
                            </tr>
                            <tr height="30px" ng-show="attachements != null && attachements.length == 0">
                                <td colspan="4" align="center" style="vertical-align:middle"> 
                                No data available in table
                                </td>
                            </tr>
                        </tbody>
                     </table>
                     <div class="row" ng-show="attachements != null && attachements.length > 5">
                        <div class="col-md-12">
                            <span class="pull-right">
                                <form class="form-inline">
                                <div class="form-group">
            
                                    <button type="button" class="btn btn-primary" ng-disabled="aCurPage == 0" ng-click="aCurPage = aCurPage-1">PREV</button>
                                    <span>Page {{aCurPage + 1}} of {{ aNumberOfPages() }}</span>
            
                                    <button type="button" class="btn btn-primary" ng-disabled="aCurPage >= attachements.length/5 - 1" ng-click="aCurPage = aCurPage+1">NEXT</button>
                                </div>
                                </form>
                            </span>
                        </div>
                    </div>
                 </div>
       
                 <div ng-show="regStudies != null && regStudies.length > 0">
                     <label style="margin-left:40px;">Other Consented Studies:</label>
                     <label style="font-weight:normal;">{{regStudiesString}}</label>
                 </div>
             </div>
                
                <div>
                
                <div class="pageBlockSection" ng-show="pageMode == 'View'">Consent Activity</div>
                    <div style="width:80% !important; margin-left:auto;margin-right:auto;margin-top:20px; ">
                    <div ng-show="conActivityList.length > 0 && pageMode == 'View'">
                    <table class="table .table-bordered" border="1">
                        <thead class="thead-inverse">
                            <tr>
                                <th ng-click="sort('conActStatus')" style="text-align: center;">Consent Status
                                    <span class="glyphicon sort-icon" ng-show="sortKey=='conActStatus'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                </th>
                                <th ng-click="sort('conActDate')" style="text-align: center;">Date of Consent Status
                                    <span class="glyphicon sort-icon" ng-show="sortKey=='conActDate'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                </th>
                                <th ng-click="sort('conReasonGrid')" style="text-align: center;">Reason for Withdrawal
                                    <span class="glyphicon sort-icon" ng-show="sortKey=='conReasonGrid'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="rec in conActivityList | orderBy:sortKey:reverse|pagination: (caCurPage * 5)| limitTo:5 track by $index">
                                <td align="center">{{rec.conActStatus}}</td>
                                <td align="center">{{rec.conActDate}}</td>
                                <td align="center" >{{rec.conActStatus == 'Consent Withdrawn' ? rec.conReasonGrid : ' - '}}</td>
                                                                
                            </tr>
                            <tr height="30px" ng-show="conActivityList != null && conActivityList.length == 0">
                                <td colspan="3" align="center" style="vertical-align:middle"> 
                                No data available in table
                                </td>
                            </tr>

                        </tbody>
                     </table>
                     <div class="row" ng-show="conActivityList != null && conActivityList.length > 5">
                        <div class="col-md-12">
                            <span class="pull-right">
                                <form class="form-inline">
                                <div class="form-group">
            
                                    <button type="button" class="btn btn-primary" ng-disabled="caCurPage == 0" ng-click="caCurPage = caCurPage-1">PREV</button>
                                    <span>Page {{caCurPage + 1}} of {{ caNumberOfPages() }}</span>
            
                                    <button type="button" class="btn btn-primary" ng-disabled="caCurPage >= conActivityList.length/5 - 1" ng-click="caCurPage = caCurPage + 1">NEXT</button>
                                </div>
                                </form>
                            </span>
                        </div>
                    </div>
                    </div>
                 </div>
                 </div>
            </div>    
             
            <div>
            <div class="pageBlockSection">IBD Diagnosis Information</div>
                <div align="center" ng-show = "pageMode == 'Edit' || pageMode == 'New'"><br/>
                    <input type="button"  value="Add Diagnosis" ng-click="addDiagnosis()" style="{!IF(isAdmin == 'Yes','display:none','display:block')}"/>
                </div>
                <div style="width:80% !important; margin-left:auto;margin-right:auto;margin-top:20px; ">
                <div ng-show="diagnosisList.length > 0">
                    <table class="table .table-bordered" border="1">
                        <thead class="thead-inverse">
                            <tr>
                                <th ng-click="sort('diagnosis')" style="text-align: center;">IBD Diagnosis
                                    <span class="glyphicon sort-icon" ng-show="sortKey=='diagnosis'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                </th>
                                <th ng-click="sort('diagnosisDate')" style="text-align: center;">Date Diagnosis Recorded in eCRF
                                    <span class="glyphicon sort-icon" ng-show="sortKey=='diagnosisDate'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                </th>
                                <th ng-show = "pageMode == 'Edit' || pageMode == 'New'" style="text-align: center;" align="center">Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="rec in diagnosisList | orderBy:sortKey:reverse|pagination: (dCurPage * 5)| limitTo:5 track by $index">
                                <td align="center">{{rec.diagnosis}}</td>
                                <td align="center">{{rec.diagnosisDate}}</td>
                                <td ng-show = "pageMode == 'Edit' || pageMode == 'New'" align="center">
                                    <input type="button" value="Delete" ng-click="diagDeleteClick(rec,diagnosisList.indexOf(rec))"/>
                                </td>
                            </tr>
                            <tr height="30px" ng-show="diagnosisList != null && diagnosisList.length == 0">
                                <td colspan="3" align="center" style="vertical-align:middle"> 
                                No data available in table
                                </td>
                            </tr>

                        </tbody>
                     </table>
                     <div class="row" ng-show="diagnosisList != null && diagnosisList.length > 5">
                        <div class="col-md-12">
                            <span class="pull-right">
                                <form class="form-inline">
                                <div class="form-group">
            
                                    <button type="button" class="btn btn-primary" ng-disabled="dCurPage == 0" ng-click="dCurPage = dCurPage-1">PREV</button>
                                    <span>Page {{dCurPage + 1}} of {{ dNumberOfPages() }}</span>
            
                                    <button type="button" class="btn btn-primary" ng-disabled="dCurPage >= diagnosisList.length/5 - 1" ng-click="dCurPage = dCurPage + 1">NEXT</button>
                                </div>
                                </form>
                            </span>
                        </div>
                    </div>
                 </div>
   
                    
                 </div>
            </div>
            </apex:pageblock>  
        </div>
        </apex:form>
         <div>
            <modal-dialog show='modalShown' type='Loading'>
                <div class="bar">
                <p>loading</p>
                </div>
            </modal-dialog> 
        </div>
         
        <div>
            <modal-dialog show='FileUploadWindow' width='40%' height='230px' type='FileUploadWindow' style="overflow:auto">
                <apex:form >
                <div style="margin-top:18px"/>
                <apex:pageblock >
                    <apex:pageblockbuttons location="bottom">
                        <input type="button" value="Cancel" ng-click="regDocCancelClicked()"/>
                        <input type="button" value="Upload" ng-click="uploadFile()"/>
                    </apex:pageblockbuttons>
                    <apex:pageblocksection id="profd" collapsible="false" columns="1">
                    <div>
                    <table width="100%" border="0" cellpadding="0" cellspacing="0">
                        <tr width="100%" height="30px">
                            <td align="left" width="30%">
                                <label class="labelCol" style="display:inherit;margin-top: 3px;">Document Type</label>
                            </td>
                            <td width="70%">
                                <select ng-model="attachForm.docType" ng-options="val for val in docTypeValues" style="display: inherit;margin-top:3px;height: 23px;"> 
                                </select>
                                
                            </td>
                        </tr>
                        <tr width="100%" height="50px" style="margin-top:5px">
                            <td align="left" width="30%">
                                <label class="labelCol" style="display:initial;">Document Name</label>
                            </td>
                            <td width="70%">
                                <div class="block">
                                <input type="text" style="margin-bottom: 8px;padding-left: 4px;;width:75%;vertical-align: -webkit-baseline-middle;" class="input-disabled" id="abc" readonly="readonly">
                                <label style="margin-left:3px;width:25%;display: initial;">
                                    <span class="btn btn-primary,input-group-btn">
                                        Browse&hellip; <input type="file" id="myFile" class="file" ng-model="myFile" style="display: none;" />
                                    </span>
                                </label>
                                </input>
                                </div>
                            </td>
                        </tr>
                     </table>
                    </div>
                    </apex:pageblockSection>
                </apex:pageblock>
                </apex:form>
             </modal-dialog>
         </div>
         <div>
             <modal-dialog show='DiagnosisWindow' width='40%' height='250px' type='DiagnosisWindow' style="overflow:auto">
                <apex:form >
                <div style="margin-top:18px"/>
                <apex:pageblock >
                    <apex:pageblockbuttons location="bottom">
                        <input type="button" value="Cancel" ng-click="diagCancelClicked()"/>
                        <input type="button" value="Save" ng-click="diagSaveClicked()"/>
                    </apex:pageblockbuttons>
                    <apex:pageblocksection id="profd" collapsible="false" columns="1">
                    <div>
                        <table width="100%" border="0" cellpadding="0" cellspacing="0">  
                            <tr>
                                <td align="right" width="20%" style="vertical-align: middle;">
                                    <label class="labelCol" style="display:inherit;">IBD Diagnosis<abbr class="req" >*</abbr></label>
                                </td>
                                <td width="20%" style="vertical-align: middle;">
                                    <select ng-model="diagForm.diagnosis" ng-options="val for val in diagnosisValues" style="display: inherit;margin-left:10px;margin-top: 3px;"> 
                                    </select>
                                </td>
                            </tr>
                            <tr width="100%" height="30px">
                                <td align="right" width="20%" style="vertical-align: middle;">
                                    <label class="labelCol" style="display:inherit;">Date Diagnosis Recorded in eCRF</label>
                                </td>
                                <td width="30%" style="vertical-align: middle;">
                                <label class="dataCol" style="display:inherit;font-weight:normal;">
                                    {{diagForm.diagnosisDate}}
                                    </label>
                                </td>
                            </tr>
                        </table>
                    </div>
                    </apex:pageblockSection>
                </apex:pageblock>
                </apex:form>
            </modal-dialog>
         </div>
        </div>
         </div>
        <div style="{!IF(isAdmin == 'Yes','display:none','display:block')}">
            <c:Plexus_Footer > </c:Plexus_Footer>
        </div>
    </div>
    </div>
</apex:page> -->
</apex:page>